@model BilkoNavigator_.Models.Herb

@{
    ViewData["Title"] = "Редакция на билка";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<section class="herb-form-page">
    <nav class="herb-breadcrumbs" aria-label="Навигация">
        <a asp-action="Index">Каталог</a>
        <span class="herb-breadcrumbs__sep">/</span>
        <a asp-action="Details" asp-route-id="@Model.Id">@Model.PopularName</a>
        <span class="herb-breadcrumbs__sep">/</span>
        <span class="herb-breadcrumbs__current">Редакция</span>
    </nav>

    <header class="herb-form-header">
        <div>
            <h1 class="herb-form-title">Редакция на билка</h1>
            <p class="herb-form-subtitle">Актуализирай информацията, за да е полезна и точна.</p>
        </div>

        <div class="herb-form-header__actions">
            <a class="bn-btn bn-btn--ghost" asp-action="Details" asp-route-id="@Model.Id">Преглед</a>
            <a class="bn-btn bn-btn--ghost" asp-action="Index">Каталог</a>
        </div>
    </header>

    <form class="herb-form"
          asp-controller="Herbs"
          asp-action="Edit"
          method="post"
          enctype="multipart/form-data">

        @Html.AntiForgeryToken()
        <input type="hidden" name="Id" value="@Model.Id" />

        @if (!ViewData.ModelState.IsValid)
        {
            <div asp-validation-summary="All" class="bn-validation"></div>
        }
        
        <div class="herb-form-grid">
            <div class="herb-form-card">
                <h2 class="herb-form-card__title">Основна информация</h2>

                <div class="bn-field">
                    <label class="bn-label" for="PopularName">Популярно име</label>
                    <input id="PopularName" name="PopularName" type="text" value="@Model.PopularName" class="bn-input" />
                </div>

                <div class="bn-field">
                    <label class="bn-label" for="LatinName">Латинско име</label>
                    <input id="LatinName" name="LatinName" type="text" value="@Model.LatinName" class="bn-input" />
                </div>

                <div class="bn-field">
                    <label class="bn-label" for="DialectNames">Диалектни имена</label>
                    <input id="DialectNames" name="DialectNames" type="text" value="@Model.DialectNames" class="bn-input" />
                </div>

                <div class="bn-field">
                    <label class="bn-label" for="Habitat">Местообитание</label>
                    <input id="Habitat" name="Habitat" type="text" value="@Model.Habitat" class="bn-input" />
                </div>

                <div class="bn-row-2">
                    <div class="bn-field">
                        <label class="bn-label" for="Season">Сезон</label>
                        <input id="Season" name="Season" type="text" value="@Model.Season" class="bn-input" />
                    </div>

                    <div class="bn-field">
                        <label class="bn-label" for="UsedPart">Използвана част</label>
                        <input id="UsedPart" name="UsedPart" type="text" value="@Model.UsedPart" class="bn-input" />
                    </div>
                </div>

                <div class="bn-row-2">
                    <div class="bn-field">
                        <label class="bn-label" for="Aroma">Аромат</label>
                        <input id="Aroma" name="Aroma" type="text" value="@Model.Aroma" class="bn-input" />
                    </div>

                    <div class="bn-field">
                        <label class="bn-label" for="Taste">Вкус</label>
                        <input id="Taste" name="Taste" type="text" value="@Model.Taste" class="bn-input" />
                    </div>
                </div>

                <div class="bn-row-2 bn-row-2--checks">
                    <label class="bn-check">
                        <input type="checkbox" name="IsPoisonous" value="true" @(Model.IsPoisonous ? "checked" : "") />
                        <span>Отровна</span>
                    </label>

                    <label class="bn-check">
                        <input type="checkbox" name="IsProtected" value="true" @(Model.IsProtected ? "checked" : "") />
                        <span>Защитена</span>
                    </label>
                </div>
            </div>

            <aside class="herb-form-side">
                <div class="herb-form-card">
                    <h2 class="herb-form-card__title">Снимка</h2>

                    <div class="bn-image">
                        <div class="bn-image__frame">
                            @if (Model.Image != null)
                            {
                                <img id="imagePreview" class="bn-image__img" src="@Model.Image.ImagePath" alt="@Model.PopularName" />
                            }
                            else
                            {
                                <div id="imagePreviewPlaceholder" class="bn-image__placeholder" aria-hidden="true"></div>
                                <img id="imagePreview" class="bn-image__img" src="#" alt="Преглед на изображението" style="display:none;" />
                            }
                        </div>

                        <div class="bn-field">
                            <label class="bn-label" for="ImageFile">Смени изображение</label>
                            <input id="ImageFile"
                                   type="file"
                                   name="ImageFile"
                                   class="bn-input"
                                   accept="image/*"
                                   onchange="previewImage(event)" />
                        </div>

                        <div class="bn-hint">
                            Препоръчителен формат: JPG или PNG. Квадратна снимка изглежда най-добре.
                        </div>
                    </div>
                </div>

                <div class="herb-form-card">
                    <h2 class="herb-form-card__title">Текст</h2>

                    <div class="bn-field">
                        <label class="bn-label" for="Benefits">Ползи</label>
                        <textarea id="Benefits" name="Benefits" class="bn-textarea" rows="4">@Model.Benefits</textarea>
                    </div>

                    <div class="bn-field">
                        <label class="bn-label" for="Description">Описание</label>
                        <textarea id="Description" name="Description" class="bn-textarea" rows="6">@Model.Description</textarea>
                    </div>
                </div>
            </aside>
        </div>

        <div class="herb-form-footer">
            <a class="bn-btn bn-btn--ghost" asp-action="Index">Отказ</a>
            <button type="submit" class="bn-btn bn-btn--primary">Запази</button>
        </div>
    </form>
</section>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        function previewImage(event) {
            const input = event.target;
            const preview = document.getElementById('imagePreview');
            const placeholder = document.getElementById('imagePreviewPlaceholder');

            if (!input.files || !input.files[0]) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                if (placeholder) placeholder.style.display = "none";
                preview.src = e.target.result;
                preview.style.display = "block";
            };
            reader.readAsDataURL(input.files[0]);
        }
    </script>
}

